#!/bin/bash

THREADS=$(($(nproc)+1))
ARCH=$1
LAST_ARCH=$(cat .build-arch)
echo $ARCH > .build-arch

if [ "$ARCH" = "clean" ]
then
	make distclean
	exit
fi

if [ "$ARCH" = "$LAST_ARCH" ]
then
	printf "\nStarting build with target=$1\n"
	make -j $THREADS > log 2> >(tee err >&2)
else
	make distclean

	../configure --target=$1 CPPFLAGS=-DDEBUG CXXFLAGS="-g -O0" && printf "\nStarting build with target=$1\n" && make -j $THREADS > log 2> >(tee err >&2)
#	../configure --target=$1 CPPFLAGS=-DDEBUG CXXFLAGS="-g -O0" && printf "\nStarting build with target=$1\n" && make -j $THREADS &> log

#	nano err
fi
